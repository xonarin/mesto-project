(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{k:()=>D});var t=document.querySelector(".popup_view-image"),n=t.querySelector(".popup__image"),o=t.querySelector(".popup__description"),r=document.querySelector(".popup_form_add-card"),c=document.querySelector(".popup_form_edit-profile"),a=document.querySelector(".popup_avatar"),l=document.querySelector(".popup_delete");function s(e){e.classList.add("popup_opened"),document.addEventListener("keydown",u)}function i(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",u)}function u(e){"Escape"===e.key&&i(document.querySelector(".popup_opened"))}Array.from(document.querySelectorAll(".form__close")).forEach((function(e){e.addEventListener("click",(function(e){i(e.target.closest(".popup"))}))})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&i(e)}))}));var d,m,f,p,_,v,h,b=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__avatar-container"),S=document.querySelector(".profile__avatar"),g=document.querySelector(".profile__user-name"),E=document.querySelector(".profile__user-description"),q=c.querySelector(".form"),L=document.querySelector(".profile__add-button"),k=document.forms.edit,C=document.forms.avatar,x=document.forms.add;d={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},m=Array.from(document.querySelectorAll(d.formSelector)),f=function(e,t){p(e)?(t.classList.add(d.inactiveButtonClass),t.disabled=!0):(t.classList.remove(d.inactiveButtonClass),t.disabled=!1)},p=function(e){return e.some((function(e){return!e.validity.valid}))},_=function(e,t){t.validity.valid?h(e,t):v(e,t,t.validationMessage)},v=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(d.inputErrorClass),o.textContent=n,o.classList.add(d.errorClass)},h=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(d.inputErrorClass),n.classList.remove(d.errorClass),n.textContent=""},m.forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(d.inputSelector)),n=e.querySelector(d.submitButtonSelector);f(t,n),t.forEach((function(o){o.addEventListener("input",(function(){_(e,o),f(t,n)}))}))}(e)}));var A={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"a39c8558-f48b-417f-a95f-ba9abdcaf643","Content-Type":"application/json"}};function U(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var T=document.querySelector(".elements__list"),w=document.querySelector("#card-template").content;function O(e,r,c,a,u){var d=w.querySelector(".element").cloneNode(!0),m=d.querySelector(".element__image"),f=d.querySelector(".element__like-button"),p=d.querySelector(".element__like-count");return m.src=e,m.alt=r,d.querySelector(".element__title").textContent=r,p.textContent=u.length,u?(function(e,t,n){e.querySelector(".element__like-button").addEventListener("click",(function(e){e.target.classList.contains("element__like-button_active")?function(e){return fetch("".concat(A.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:A.headers}).then(U)}(n).then((function(n){e.target.classList.toggle("element__like-button_active"),t.textContent=n.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(A.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:A.headers}).then(U)}(n).then((function(n){e.target.classList.toggle("element__like-button_active"),t.textContent=n.likes.length})).catch((function(e){console.log(e)}))}))}(d,p,c),u.forEach((function(e){e._id===D&&f.classList.add("element__like-button_active")}))):p.textContent=0,a===D&&(P(d),d.querySelector(".element__btn-trash").addEventListener("click",(function(e){var t;s(l),t=e,l.querySelector(".form__submit_confirm").addEventListener("click",(function(e){(function(e){return fetch("".concat(A.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:A.headers}).then(U)})(c).then((function(){console.log(c),t.target.closest(".element").remove(),i(l)})).catch((function(e){console.log(e)}))}))}))),d.querySelector(".element__image").addEventListener("click",(function(){n.src=e,n.alt=r,o.textContent=r,s(t)})),d}function P(e){var t=document.createElement("button");return t.classList.add("element__btn-trash"),t.setAttribute("type","button"),e.prepend(t),P}fetch("".concat(A.baseUrl,"/cards"),{method:"GET",headers:A.headers}).then(U).then((function(e){console.log(e),e.forEach((function(e){T.append(O(e.link,e.name,e._id,e.owner._id,e.likes))}))})).catch((function(e){console.log(e)}));var D="";fetch("".concat(A.baseUrl,"/users/me"),{method:"GET",headers:A.headers}).then(U).then((function(e){D=e._id,g.textContent=e.name,E.textContent=e.about,S.src=e.avatar})).catch((function(e){console.log(e)})),C.addEventListener("submit",(function(e){var t;e.preventDefault(),C.elements.submit.textContent="Сохранение...",(t=C.elements.link.value,fetch("".concat(A.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:A.headers,body:JSON.stringify({avatar:t})}).then(U)).then((function(){S.src=C.elements.link.value})).catch((function(e){console.log(e)})).finally((function(){i(a)}))})),q.addEventListener("submit",(function(e){var t,n;e.preventDefault(),k.elements.submit.textContent="Сохранение...",(t=k.elements.name.value,n=k.elements.about.value,fetch("".concat(A.baseUrl,"/users/me"),{method:"PATCH",headers:A.headers,body:JSON.stringify({name:t,about:n})}).then(U)).then((function(){g.textContent=k.elements.name.value,E.textContent=k.elements.about.value})).catch((function(e){console.log(e)})).finally((function(){i(c),q.reset()}))})),x.addEventListener("submit",(function(e){var t,n;e.preventDefault(),x.elements.submit.textContent="Сохранение...",(t=x.elements.name.value,n=x.elements.image.value,fetch("".concat(A.baseUrl,"/cards"),{method:"POST",headers:A.headers,body:JSON.stringify({name:t,link:n})}).then(U)).then((function(e){console.log(e),T.prepend(O(x.elements.image.value,x.elements.name.value,e._id,e.owner._id,e.likes)),i(r),x.reset(),x.elements.submit.classList.add("form__submit_disabled"),x.elements.submit.disabled=!0})).catch((function(e){console.log(e)}))})),b.addEventListener("click",(function(){k.elements.name.value=g.textContent,k.elements.about.value=E.textContent,s(c)})),L.addEventListener("click",(function(){return s(r)})),y.addEventListener("click",(function(){return s(a)}))})();